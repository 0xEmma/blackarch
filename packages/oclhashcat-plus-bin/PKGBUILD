pkgname=oclhashcat-plus-bin
pkgver=0.15
pkgrel=2
pkgdesc="Worlds fastest WPA cracker with dictionary mutation engine"
url=('http://hashcat.net/oclhashcat-plus/')
arch=('i686' 'x86_64')
license=('custom')
optdepends=('nvidia-utils>=310.32: For for gpu support via Nvidia CUDA' 
	    'catalyst-utils>=13.4: For gpu support via ATI Stream'
	    'opencl-catalyst: For gpu support via ATI Stream')
source=("http://hashcat.net/files/oclHashcat-plus-$pkgver.7z")
md5sums=('7a221f9b5d00ebc3474b33949d0fb250')
options=('!strip')

package() {
  find "$srcdir/oclHashcat-plus-$pkgver" \( -name "*.cmd" -o -name "*.exe" \) -print | xargs rm

  install -dm755 "$pkgdir/opt"
  install -dm755 "$pkgdir/usr/bin"

  if [ "$CARCH" = "x86_64" ]; then
    rm "$srcdir/oclHashcat-plus-$pkgver/cudaHashcat-plus32.bin"
    rm "$srcdir/oclHashcat-plus-$pkgver/oclHashcat-plus32.bin"

    echo -e '#!/bin/bash\n/opt/oclhashcat-plus/cudaHashcat-plus64.bin "\$@"' > "$pkgdir/usr/bin/cudaHashcat-plus"
    chmod a+x "$pkgdir/usr/bin/cudaHashcat-plus"
    echo -e '#!/bin/bash\n/opt/oclhashcat-plus/oclHashcat-plus64.bin "\$@"' > "$pkgdir/usr/bin/oclHashcat-plus"
    chmod a+x "$pkgdir/usr/bin/oclHashcat-plus"
  else
    rm "$srcdir/oclHashcat-plus-$pkgver/cudaHashcat-plus64.bin"
    rm "$srcdir/oclHashcat-plus-$pkgver/oclHashcat-plus64.bin"

    echo -e "#!/bin/bash\n/opt/oclhashcat-plus/cudaHashcat-plus32.bin \$@" > "$pkgdir/usr/bin/cudaHashcat-plus"
    chmod a+x "$pkgdir/usr/bin/cudaHashcat-plus"
    echo -e "#!/bin/bash\n/opt/oclhashcat-plus/oclHashcat-plus32.bin \$@" > "$pkgdir/usr/bin/oclHashcat-plus"
    chmod a+x "$pkgdir/usr/bin/oclHashcat-plus"
  fi

  cp -rv "$srcdir/oclHashcat-plus-$pkgver" "$pkgdir/opt/oclhashcat-plus"
}
